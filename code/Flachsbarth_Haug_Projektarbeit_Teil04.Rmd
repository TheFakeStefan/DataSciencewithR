---
title: "Projektarbeit Stefan Flachsbarth & Martin Haug<br/><br/>Teil 4 - Visualisieren Wahl- und Strukturdaten"
subtitle: "<br/>Analyse von Wahlergebnissen, Strukturdaten und Presseberichterstattung<br/>Bundestagswahlen im Zeitraum 1990 - 2017"
author: "<br/><br/>Stefan Flachsbarth, Martin Haug"
date: "`r Sys.Date()`"
output:
  html_document: 
    fig_height: 8
    fig_width: 12
    highlight: tango
    theme: paper
    toc: yes
    toc_depth: 3
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(comment = NA)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
```


## 5. Visualisierung der Wahl- und Strukturdaten

#### Laden der benötigten R-Pakete

```{r}
library(dplyr)
library(readxl)
library(readr)
library(tidyverse)
library(DBI)
library(fs)
library(rstudioapi)
library(ggplot2)
library(reshape2)
```


### 5.1. Laden der Daten aus der SQL-Datenbank

```{r}

# Definition einer Funktion, um die Daten in die SQL-Datenbank zu schreiben
ReadMyData <- function(table_name, table_content) {
  # Verbindung initialisieren
  con <- dbConnect(RPostgreSQL::PostgreSQL(),
    host = 'hdm-sql.think-data.de', 
    dbname = 'postgres',
    user = 'postgres',
    password = '%%CENSORED%%'
    # Der richtige Weg, um auf sichere Weise das Passwort abzufragen
    # password = rstudioapi::askForPassword("Database password")
    )
  
  # Lesen der geschriebenen Daten
  return(dbReadTable(con, table_name))
  
  # Verbindung lösen
  dbDisconnect(con)
}


# Definieren einer Funktion, um die deutschen Umlaute korrekt anzuzeigen
set_utf8 <- function(x) {
  # Auf alle Spalten anwenden, welche Text enthalten
  chr <- sapply(x, is.character)
  # Iterieren durch alle Textelemente in der Saple
  x[, chr] <- lapply(x[, chr, drop = FALSE], `Encoding<-`, "UTF-8")
  # Natürlich auch auf den Spaltennamen
  Encoding(names(x)) <- "UTF-8"
  # Zurückgeben
  return(x)
}

btw2017 <- ReadMyData("dfin_2017", output)
btw2017 <- set_utf8(btw2017)
head(btw2017, 5)

```


### 5.2. Beantwortung einiger konkreter Fragestellungen mit Hilfe der Wahldaten aus der PostgreSQL-Datenbank

#### Frage 1 - Welche Ergebnisse konnte die CSU bei der Bundestagswahl 2017 in den bayerischen Wahlkreisen erzielen? (Zweitstimmenanteile)

```{r}

# Extraktion der für die Analyse benötigten Daten aus dem Datensatz 'btw2017'
btw2017 <- select(btw2017, -X)
bayerncsu2017 <- btw2017%>%
  filter(LANDABK=="BY")%>%
  select(WKRNAME, CSUPZ)

# Überprüfung der Datentypen und des Ergebnisses
glimpse(bayerncsu2017)

```

##### Visualisierung der Ergebnisse mit ggplot

```{r}

# Visualisierung mit Hilfe eines horizontalen Barcharts
ggplot(bayerncsu2017, aes(x=WKRNAME, y=CSUPZ, sort(CSUPZ, descending=TRUE))) +
  geom_col() +
  coord_flip() +
  theme_classic(base_size=7) +
  ggtitle("Wahlergebnis der CSU in Bayern - Zweitstimmen in 2017") +
  labs(title="Wahlergebnis der CSU in Bayern - Zweitstimmen in 2017", subtitle="Stimmenanteil in %", x="", y="")

```

#### Interpretation

Durch die absteigende Sortierung der Wahlkreise nach Zweitstimmenanteilen kann man unschwer erkennen, dass die **CSU ihre besten Ergebnisse (deutlich über 40%) in den oberbayerischen Landkreisen Traunstein, Altötting und Bad Tölz-Wolfratshausen** erzielen konnte. Am anderen Ende der Aufstellung findet sich der Wahlkreis Nürnberg Nord, in welchem die CSU lediglich auf einen Zweitstimmenanteil von etwas über 25% kam. 


#### Frage 2 - Welcher Kandidat hat im Wahlkreis Stuttgart das Direktmandat geholt? 

```{r}

# Extrahieren der benötigten Daten aus dem Datensatz 'btw2017'
stuttgart1 <- btw2017%>%
  filter(WKRNR=="258")%>%
  select(WKRNAME, CDU1, SPD1, LIN1, GRU1, FDP1, AFD1)
stuttgart2 <- btw2017%>%
  filter(WKRNR=="259")%>%
  select(WKRNAME, CDU1, SPD1, LIN1, GRU1, FDP1, AFD1)

# Zusammenführen der beiden Stuttgarter Wahlkreise in einen Datensatz
stuttgart <- bind_rows(stuttgart1, stuttgart2)

# Umstrukturierung der Datentabelle
stuttgart.long<-melt(stuttgart,id.vars="WKRNAME")

# Visualisierung der Ergebnisse in Form eines Barcharts
ggplot(stuttgart.long, aes(x=variable,y=value,fill=factor(WKRNAME)))+
  geom_bar(stat="identity",position="dodge")+
  scale_fill_discrete(name="WKRNAME",
                      breaks=c("Stuttgart I", "Stuttgart II"),
                      labels=c("Stuttgart I", "Stuttgart II"))+
  xlab("Partei")+ylab("Wählerstimmen")+
  theme_classic(base_size=7) +
  labs(title="Erstwählerstimmen in den beiden Stuttgarter Wahlkreisen")

```

#### Interpretation

Aus der Visualisierung lässt sich erkennen, dass sich im **Wahlkreis Stuttgart I der Kandidat der CDU mit etwas über 50.000 Stimmen** und einem knappen Vorsprung vor dem Kandidaten der Grünen (knapp unter 50.000 Stimmen) durchsetzen konnte. Der **Wahlkreis Stuttgart II ging ebenfalls an den Kandidaten der CDU**, hier jedoch mit einem deutlichen Vorsprung vor dem zweitplatzierten Kandidaten der SPD.


#### Frage 3 - Wie haben sich die Ergebnisse der Parteien in Ostdeutschland im Zeitraum 1990- 2017 entwickelt?

```{r}

# Extrahieren der benötigten Daten aus dem Datensatz 'btw2027', Einfügen einen neuen Spalte 'OstWest'
Ost2017 <- btw2017%>%
  mutate(OstWest = ifelse(LANDABK %in% c("MV", "BB", "SN", "TH", "ST"), "Ost", "West"))%>%
  filter(OstWest=="Ost")%>%
  select(Wahljahr, WKRNAME, LANDABK, W1, CDU2, SPD2, LIN2, GRU2, FDP2, AFD2, OstWest)%>%
  mutate(CDUPZ = round(sum(CDU2)/sum(W1), 2))%>%
  mutate(SPDPZ = round(sum(SPD2)/sum(W1), 2))%>%  
  mutate(LINPZ = round(sum(LIN2)/sum(W1), 2))%>%
  mutate(GRUPZ = round(sum(GRU2)/sum(W1), 2))%>%
  mutate(FDPPZ = round(sum(FDP2)/sum(W1), 2))%>%
  mutate(AFDPZ = round(sum(AFD2)/sum(W1), 2))
head(Ost2017, 5)

```

#### Extrahieren der benötigten Daten für die Jahre 1990 bis 2013, Einfügen einen neuen Spalte 'OstWest'

```{r}

# Wahl 2013
btw2013 <- ReadMyData("dfin_2013", output)
btw2013 <- set_utf8(btw2013)
Ost2013 <- btw2013%>%
  mutate(OstWest = ifelse(LANDABK %in% c("MV", "BB", "SN", "TH", "ST"), "Ost", "West"))%>%
  filter(OstWest=="Ost")%>%
  select(Wahljahr, WKRNAME, LANDABK, W1, CDU2, SPD2, LIN2, GRU2, FDP2, AFD2, OstWest)%>%
  mutate(CDUPZ = round(sum(CDU2)/sum(W1), 2))%>%
  mutate(SPDPZ = round(sum(SPD2)/sum(W1), 2))%>%  
  mutate(LINPZ = round(sum(LIN2)/sum(W1), 2))%>%
  mutate(GRUPZ = round(sum(GRU2)/sum(W1), 2))%>%
  mutate(FDPPZ = round(sum(FDP2)/sum(W1), 2))%>%
  mutate(AFDPZ = round(sum(AFD2)/sum(W1), 2))
head(Ost2013, 5)

# Wahl 2009
btw2009 <- ReadMyData("dfin_2009", output)
btw2009 <- set_utf8(btw2009)
Ost2009 <- btw2009 %>%
    mutate(OstWest = ifelse(LANDABK %in% c("MV", "BB", "SN", "TH", "ST"), "Ost", "West"))%>%
    filter(OstWest=="Ost")%>%
    select(Wahljahr, WKRNAME, LANDABK, W1, CDU2, SPD2, LIN2, GRU2, FDP2, OstWest)%>%
    mutate(CDUPZ = round(sum(CDU2)/sum(W1), 2))%>%
    mutate(SPDPZ = round(sum(SPD2)/sum(W1), 2))%>%  
    mutate(LINPZ = round(sum(LIN2)/sum(W1), 2))%>%
    mutate(GRUPZ = round(sum(GRU2)/sum(W1), 2))%>%
    mutate(FDPPZ = round(sum(FDP2)/sum(W1), 2))%>%
    mutate(AFD2 ="")%>%
    mutate(AFDPZ = round(0/sum(W1), 2))
head(Ost2009, 5)

# Wahl 2005
btw2005 <- ReadMyData("dfin_2005", output)
btw2005 <- set_utf8(btw2005)
Ost2005 <- btw2005 %>%
    mutate(OstWest = ifelse(LANDABK %in% c("MV", "BB", "SN", "TH", "ST"), "Ost", "West"))%>%
    filter(OstWest=="Ost")%>%
    select(Wahljahr, WKRNAME, LANDABK, W1, CDU2, SPD2, LIN2, GRU2, FDP2, OstWest)%>%
    mutate(CDUPZ = round(sum(CDU2)/sum(W1), 2))%>%
    mutate(SPDPZ = round(sum(SPD2)/sum(W1), 2))%>%  
    mutate(LINPZ = round(sum(LIN2)/sum(W1), 2))%>%
    mutate(GRUPZ = round(sum(GRU2)/sum(W1), 2))%>%
    mutate(FDPPZ = round(sum(FDP2)/sum(W1), 2))%>%
    mutate(AFD2 ="")%>%
    mutate(AFDPZ = round(0/sum(W1), 2))
head(Ost2005, 5)

# Wahl 2002
btw2002 <- ReadMyData("dfin_2002", output)
btw2002 <- set_utf8(btw2002)
Ost2002 <- btw2002 %>%
    mutate(OstWest = ifelse(LANDABK %in% c("MV", "BB", "SN", "TH", "ST"), "Ost", "West"))%>%
    filter(OstWest=="Ost")%>%
    select(Wahljahr, WKRNAME, LANDABK, W1, CDU2, SPD2, LIN2, GRU2, FDP2, OstWest)%>%
    mutate(CDUPZ = round(sum(CDU2)/sum(W1), 2))%>%
    mutate(SPDPZ = round(sum(SPD2)/sum(W1), 2))%>%  
    mutate(LINPZ = round(sum(LIN2)/sum(W1), 2))%>%
    mutate(GRUPZ = round(sum(GRU2)/sum(W1), 2))%>%
    mutate(FDPPZ = round(sum(FDP2)/sum(W1), 2))%>%
    mutate(AFD2 ="")%>%
    mutate(AFDPZ = round(0/sum(W1), 2))
head(Ost2002, 5)

# Wahl 1998
btw1998 <- ReadMyData("dfin_1998", output)
btw1998 <- set_utf8(btw1998)
Ost1998 <- btw1998 %>%
    mutate(OstWest = ifelse(LANDABK %in% c("MV", "BB", "SN", "TH", "ST"), "Ost", "West"))%>%
    filter(OstWest=="Ost")%>%
    select(Wahljahr, WKRNAME, LANDABK, W1, CDU2, SPD2, LIN2, GRU2, FDP2, OstWest)%>%
    mutate(CDUPZ = round(sum(CDU2)/sum(W1), 2))%>%
    mutate(SPDPZ = round(sum(SPD2)/sum(W1), 2))%>%  
    mutate(LINPZ = round(sum(LIN2)/sum(W1), 2))%>%
    mutate(GRUPZ = round(sum(GRU2)/sum(W1), 2))%>%
    mutate(FDPPZ = round(sum(FDP2)/sum(W1), 2))%>%
    mutate(AFD2 ="")%>%
    mutate(AFDPZ = round(0/sum(W1), 2))
head(Ost1998, 5)

# Wahl 1994
btw1994 <- ReadMyData("dfin_1994", output)
btw1994 <- set_utf8(btw1994)
Ost1994 <- btw1994 %>%
    mutate(OstWest = ifelse(LANDABK %in% c("MV", "BB", "SN", "TH", "ST"), "Ost", "West"))%>%
    filter(OstWest=="Ost")%>%
    select(Wahljahr, WKRNAME, LANDABK, W1, CDU2, SPD2, LIN2, GRU2, FDP2, OstWest)%>%
    mutate(CDUPZ = round(sum(CDU2)/sum(W1), 2))%>%
    mutate(SPDPZ = round(sum(SPD2)/sum(W1), 2))%>%  
    mutate(LINPZ = round(sum(LIN2)/sum(W1), 2))%>%
    mutate(GRUPZ = round(sum(GRU2)/sum(W1), 2))%>%
    mutate(FDPPZ = round(sum(FDP2)/sum(W1), 2))%>%
    mutate(AFD2 ="")%>%
    mutate(AFDPZ = round(0/sum(W1), 2))
head(Ost1994, 5)

# Wahl 1990
btw1990 <- ReadMyData("dfin_1990", output)
btw1990 <- set_utf8(btw1990)
Ost1990 <- btw1990 %>%
    mutate(OstWest = ifelse(LANDABK %in% c("MV", "BB", "SN", "TH", "ST"), "Ost", "West"))%>%
    filter(OstWest=="Ost")%>%
    select(Wahljahr, WKRNAME, LANDABK, W1, CDU2, SPD2, LIN2, GRU2, FDP2, OstWest)%>%
    mutate(CDUPZ = round(sum(CDU2)/sum(W1), 2))%>%
    mutate(SPDPZ = round(sum(SPD2)/sum(W1), 2))%>%  
    mutate(LINPZ = round(sum(LIN2)/sum(W1), 2))%>%
    mutate(GRUPZ = round(sum(GRU2)/sum(W1), 2))%>%
    mutate(FDPPZ = round(sum(FDP2)/sum(W1), 2))%>%
    mutate(AFD2 ="")%>%
    mutate(AFDPZ = round(0/sum(W1), 2))
head(Ost1990, 5)

```

#### Verbinden der Einzeldateien

```{r}

# Verbinden der Einzeldatensätze aus den jeweiligen Wahljahren
ostwahl <- rbind(Ost2017, Ost2013, Ost2009, Ost2005, Ost2002, Ost1998, Ost1994, Ost1990)
ostwahl <- ostwahl%>%
  filter(WKRNAME=="Leipzig I")%>%
  select(Wahljahr, CDUPZ, SPDPZ, GRUPZ, LINPZ, AFDPZ, FDPPZ)

# Umwandlung des Datensatz zur Vorbereitung der Visualisierung
ostwahl.long <- melt(ostwahl,id.vars="Wahljahr")
ostwahl <- ostwahl.long

# Überprüfung der Datentypen
glimpse(ostwahl)

# Visualisierung der Daten mit Hilfe einen Liniendiagramms
ggplot(ostwahl, aes(x=Wahljahr, y=value, color=variable)) +
  geom_line() +
  theme_classic() +
  expand_limits(y=0)

```

#### Interpretation

Mit der Visualisierung in Form eines Liniendiagramms lässt sich recht gut die **Entwicklung der Parteienlandschaft in Ostdeutschland** in den vergangenen 30 Jahren nachvollziehen. Die **FDP** sowie die **Grünen** bewegen sich im gesamten Betrachtungszeitraum in Ostdeutschland auf relativ niedrigem Niveau - manchmal etwas über, manchmal etwas unter der Fünf-Prozent-Hürde. Die **Linkspartei** erhält in den 1990er Jahren in Ostdeutschland relativ wenig Zuspruch, legt jedoch in den Jahren 2005 und 2009 deutlich zu. Hintergrund dürften in diesem Zusammenhang die intensiv geführten Debatten um die Sozialpolitik (Stichworte: Agenda 2010, Hartz IV) eine wichtige Rolle gespielt haben. In den Folgejahren sanken die Wahlergebnisse der Linkspartei kontinuierlich. Die stärkste Partei in Ostdeutschland war fast über den gesamten Betrachtungszeitraum die **CDU** mit Wahlergebnissen zwischen annähernd 30% bis über 40% im Jahre 1990. Überflügelt wurde sie nur in den Jahren 1998 und 2005 knapp, im Jahr 2002 etwas deutlicher von der **SPD**. Die **AFD** wurde erst in den 2010er Jahren als Partei gegründet und erlebte in Ostdeutschland bei den Bundestagswahlen 2013 und 2017 einen rasanten Aufstieg. Dieser scheint vor allem auf Kosten der Linkspartei, der SPD und der CDU zurückzuführen sein, welche im selben Zeitraum deutliche Einbußen hinnehmen mussten. Allerdings könnten auch Bürger, die in den Jahren vor 2013 nicht zur Wahl gingen, eine wichtige Rolle für das Abschneiden der AFD gespielt haben. 


### 5.3. Auswertung von Strukturdaten

#### Verteilung der durchschnittlichen Bruttoeinkommen in Deutschland (2017)

##### Einlesen der benötigten Strukturdaten

```{r}

# btw1990 <- ReadMyData("dfin_1990", output)
# btw1990 <- set_utf8(btw1990)
bruttoeinkomm <- read_excel("C:/Weiterbildung/HdM/Projektarbeit/FINAL DATA/StrukTest/struktur_Bruttoeinkommen.xlsx")
head(bruttoeinkomm, 5)

```

##### Extraktion und Vorbereitung der für die Analyse benötigten Daten

```{r}

# Extraktion relevanter Daten
bruttoeinkomm2017 <- bruttoeinkomm%>%
  filter(Year=="2017")%>%
  rename("Bruttoentgelte"="Bruttoentgelte.je.Beschäftigten.in.Tsd..EUR")%>%
  filter(Bruttoentgelte != "NA")%>%
  select(-Column1)
bruttoeinkomm2017 <- within(bruttoeinkomm2017, {
        Bruttoentgelte <- as.numeric(as.character(Bruttoentgelte))
})
head(bruttoeinkomm2017, 5)

```

##### Visualisierung der Datenverteilung

```{r}

# Visualisierung mit Hilfe eines Histogramms
ggplot(bruttoeinkomm2017, aes(Bruttoentgelte)) +
  geom_histogram(bins = 50) +
  theme_bw() +
  labs(title="Durchschnittliches Bruttoeinkommen nach Landkreisen - 2017", x="Bruttoeinkommen in EUR", y="Anzahl Landkreise")

```

##### Interpretation

Die Verteilung der Bruttoeinkommen nach Landkreisen in Deutschland zeigt im Jahre 2017 ein Muster, das im großen und ganzen einer **Normalverteilung mit einem Mittelwert von ungefähr 48.000 EUR** ähnelt. Allerdings ist eine **leichte rechtsschiefe Verteilung** im Ansatz zu erkennen. Einige wenige Landkreise weisen ein durchschnittliches Bruttoeinkommen auf, das deutlich über dem Median bzw. Mittelwert liegt. Auf der anderen Seite ist ein relativ großer Block an Landkreisen mit einem durchschnittlichen Bruttoeinkommen zwischen 30.000 und 40.000 EUR zu beobachten. Im folgenden soll untersucht werden, worauf diese Muster möglicherweise zurückzuführen sind. 


#### Entwicklung der Bruttoeinkommen in Deutschland zwischen 1995 und 2017

Im folgenden soll untersucht werden, ob bereits in der Vergangenheit das oben aufgeführte Verteilungsmuster zu beobachten war. Hierzu müssen zunächst die Daten der entsprechenden Jahre extrahiert werden. 

```{r}

# Aufbereitung der Daten des Jahres 2013
bruttoeinkomm2013 <- bruttoeinkomm%>%
  filter(Year=="2013")%>%
  rename("Bruttoentgelte"="Bruttoentgelte.je.Beschäftigten.in.Tsd..EUR")%>%
  filter(Bruttoentgelte != "NA")%>%
  select(-Column1)
bruttoeinkomm2013 <- within(bruttoeinkomm2013, {
        Bruttoentgelte <- as.numeric(as.character(Bruttoentgelte))
})
head(bruttoeinkomm2013, 5)

# Aufbereitung der Daten des Jahres 2009
bruttoeinkomm2009 <- bruttoeinkomm%>%
  filter(Year=="2009")%>%
  rename("Bruttoentgelte"="Bruttoentgelte.je.Beschäftigten.in.Tsd..EUR")%>%
  filter(Bruttoentgelte != "NA")%>%
  select(-Column1)
bruttoeinkomm2009 <- within(bruttoeinkomm2009, {
        Bruttoentgelte <- as.numeric(as.character(Bruttoentgelte))
})
head(bruttoeinkomm2009, 5)

# Aufbereitung der Daten des Jahres 2005
bruttoeinkomm2005 <- bruttoeinkomm%>%
  filter(Year=="2005")%>%
  rename("Bruttoentgelte"="Bruttoentgelte.je.Beschäftigten.in.Tsd..EUR")%>%
  filter(Bruttoentgelte != "NA")%>%
  select(-Column1)
bruttoeinkomm2005 <- within(bruttoeinkomm2005, {
        Bruttoentgelte <- as.numeric(as.character(Bruttoentgelte))
})
head(bruttoeinkomm2005, 5)

# Aufbereitung der Daten des Jahres 2000
bruttoeinkomm2000 <- bruttoeinkomm%>%
  filter(Year=="2000")%>%
  rename("Bruttoentgelte"="Bruttoentgelte.je.Beschäftigten.in.Tsd..EUR")%>%
  filter(Bruttoentgelte != "NA")%>%
  select(-Column1)
bruttoeinkomm2000 <- within(bruttoeinkomm2000, {
        Bruttoentgelte <- as.numeric(as.character(Bruttoentgelte))
})
head(bruttoeinkomm2000, 5)

# Aufbereitung der Daten des Jahres 1995
bruttoeinkomm1995 <- bruttoeinkomm%>%
  filter(Year=="1995")%>%
  rename("Bruttoentgelte"="Bruttoentgelte.je.Beschäftigten.in.Tsd..EUR")%>%
  filter(Bruttoentgelte != "NA")%>%
  select(-Column1)
bruttoeinkomm1995 <- within(bruttoeinkomm1995, {
        Bruttoentgelte <- as.numeric(as.character(Bruttoentgelte))
})
head(bruttoeinkomm1995, 5)

```

##### Erstellen von Histogrammen für die Daten der Jahre 1995, 2000, 2005, 2009, 2013, 2017

```{r}

# Histogramm für 2017
plot2017 <- ggplot(bruttoeinkomm2017, aes(Bruttoentgelte)) +
  geom_histogram(bins = 50) +
  theme_classic() +
  labs(title="2017", x="Bruttoeinkommen in EUR", y="# LKR")

# Histogramm für 2013
plot2013 <- ggplot(bruttoeinkomm2013, aes(Bruttoentgelte)) +
  geom_histogram(bins = 50) +
  theme_classic() +
  labs(title="2013", x="Bruttoeinkommen in EUR", y="# LKR")

# Histogramm für 2009
plot2009 <- ggplot(bruttoeinkomm2009, aes(Bruttoentgelte)) +
  geom_histogram(bins = 50) +
  theme_classic() +
  labs(title="2009", x="Bruttoeinkommen in EUR", y="# LKR")

# Histogramm für 2005
plot2005 <- ggplot(bruttoeinkomm2005, aes(Bruttoentgelte)) +
  geom_histogram(bins = 50) +
  theme_classic() +
  labs(title="2005", x="Bruttoeinkommen in EUR", y="# LKR")

# Histogramm für 2000
plot2000 <- ggplot(bruttoeinkomm2000, aes(Bruttoentgelte)) +
  geom_histogram(bins = 50) +
  theme_classic() +
  labs(title="2000", x="Bruttoeinkommen in EUR", y="# LKR")

# Histogramm für 1995
plot1995 <- ggplot(bruttoeinkomm1995, aes(Bruttoentgelte)) +
  geom_histogram(bins = 50) +
  theme_classic() +
  labs(title="1995", x="Bruttoeinkommen in EUR", y="# LKR")

```

##### Anordnen der Histogramme in tabellarischer Form

```{r}

# Tabelle im Format 3 Spalten x 2 Zeilen
require(gridExtra)
grid.arrange(plot1995, plot2000, plot2005, plot2009, plot2013, plot2017, ncol=3)

```

##### Interpretation

In den Jahren von 1995 bis 2009 weisen die Verteilungsmuster der durchschnittlichen Bruttoeinkommen nach Landkreisen eine deutliche **Tendenz zur Normalverteilung** auf. Eine **leicht rechtsschiefe Verteilung ist erst in den Jahren 2013 bzw. 2017** zu erkennen. Dieses deutet darauf hin, dass im laufenden Jahrzehnt die Bruttolöhne sich in einigen wenigen Landkreisen deutlich vom Mittelwert nach oben abgesetzt haben. In den **1990er und 2000er Jahren** sind teilweise noch **Häufungen im untersten Quartil der Verteilung** zu erkennen. Hier ist zu vermuten, dass es sich um Landkreise in Ostdeutschland handelt, die nach der Wiedervereinigung noch deutlich niedrigere Einkommen aufwiesen als westdeutsche Landkreise. Diese Hypothese wird im Folgenden noch näher untersucht. 


#### Entwicklung der Bruttoeinkommen im Zeitverlauf München vs. Sachsen-Anhalt

Ergänzend zur Darstellung der Entwicklung im Zeitverlauf mit Hilfe von Histogrammen, soll nun an zwei ausgewählten Gebieten untersucht werden, wie sich die Bruttoeinkommen über die vergangenen 25 Jahre entwickelt haben. Die **Stadt München** wurde beispielhaft ausgewählt als eine Großstadt in Westdeutschland, die sich in den letzten Jahrzehnten wirtschaftlich sehr dynamisch entwickelt hat. Den Vergleichspunkt bietet das **Land Sachsen-Anhalt**. Ausgewählt wurde es als Beispiel einer eher ländlich geprägten Region in Ostdeutschland, mit deutlichen wirtschaftlichen Herausforderungen.  

```{r}

# Datenselektion und -aufbereitung für München
bruttoeinkomm_M <- bruttoeinkomm%>%
  filter(Schluessel=="9162")%>%
  rename("Bruttoentgelte"="Bruttoentgelte.je.Beschäftigten.in.Tsd..EUR")%>%
  filter(Bruttoentgelte != "NA")%>%
  select(-Column1)
bruttoeinkomm_M <- within(bruttoeinkomm_M, {
        Bruttoentgelte <- as.numeric(as.character(Bruttoentgelte))
})
bruttoeinkomm_M <- bruttoeinkomm_M%>%
  select(Year, Bruttoentgelte, "Stadt-/Landkreis")%>%
  rename("Standort"="Stadt-/Landkreis")
head(bruttoeinkomm_M, 5)


# Datenselektion und -aufbereitung für Sachsen-Anhalt. Da sich die Landkreisstrukturen in Sachsen-Anhalt im Betrachtungszeitraum verändert haben, werden die Medianwerte der einzelnen Landkreise als durchschnittliches Bruttoeinkommen für das Land Sachsen-Anhalt genommen.
bruttoeinkomm_ST <- bruttoeinkomm%>%
  filter(LAND_ABK=="ST")%>%
  rename("Bruttoentgelte"="Bruttoentgelte.je.Beschäftigten.in.Tsd..EUR")%>%
  filter(Bruttoentgelte != "NA")%>%
  select(-Column1)
bruttoeinkomm_ST <- within(bruttoeinkomm_ST, {
        Bruttoentgelte <- as.numeric(as.character(Bruttoentgelte))
})
bruttoeinkomm_ST <- bruttoeinkomm_ST%>%
  group_by(Year)%>%
  summarize(median(Bruttoentgelte, Year))%>%
  mutate(Standort = "Sachsen-Anhalt")%>%
  rename("Bruttoentgelte"="median(Bruttoentgelte, Year)")
head(bruttoeinkomm_ST, 5)

# Verbindung der beiden Einzeltabellen zu einer Gesamtdatei
bruttoeinkommen_M_ST <- rbind(bruttoeinkomm_M, bruttoeinkomm_ST)
head(bruttoeinkommen_M_ST, 5)

# Visualisierung mit Hilfe eines Liniendiagramms
ggplot(bruttoeinkommen_M_ST, aes(x=Year, y=Bruttoentgelte, color=Standort)) +
  geom_line() +
  theme_classic() +
  expand_limits(y=0) +
  labs(title="Bruttoeinkommen 1995 - 2017 im Vergleich", x="Jahr", y="Bruttoentgelte in TEUR")


```

##### Interpretation

Die Grafik zeigt, dass sich die **Bruttoeinkommen in beiden Gebieten im Betrachtungszeitraum nach oben entwickelt** haben. Die Stadt München zeigt jedoch ein deutlich stärkeres Wachstum als das Land Sachsen-Anhalt. Während das durchschnittliche Bruttoeinkommen in **Sachsen-Anhalt** von 21.600 EUR auf 34.300 EUR gestiegen ist - was einer **Steigerung von 15,9%** entspricht - entwickelt es sich in der **Stadt München** von  44.800 EUR im Jahre 1995 auf 85.700 EUR im Jahre 2017. Dieses entspricht einer **Steigerung von 91,3%**. Das Liniendiagramm zeigt darüber hinaus auch, dass sich die Schere zwischen beiden Gebieten im Betrachtungszeitraum kontinuierlich auseinanderentwickelt hat. 


#### Verfügbares Einkommen - Ost und West im Vergleich

Im Folgenden soll untersucht werden, ob sich auch bei den verfügbaren Einkommen ähnliche Muster und Trends aufweisen lassen wie bei den Bruttolöhnen. Diese geschieht im ersten Schritt auf Basis der Daten des Jahres 2016. Zunächst werden wieder die Daten aus der SQL-Datenbank geladen.

##### Laden der Daten aus der Datenbank

```{r}

# Laden der Daten
verfeinkomm <- read_excel("C:/Weiterbildung/HdM/Projektarbeit/FINAL DATA/StrukTest/struktur_VerfEinkommen.xlsx")
head(verfeinkomm, 5)

```

##### Extraktion und Aufbereitung der für die Analyse benötigten Daten

```{r}

# Extraktion und Aufbereitung der benötigten Daten
verfeinkomm2016 <- verfeinkomm%>%
  filter(Year=="2016")%>%
  rename("Verf_Einkommen"="Verfügbares.Einkommen.je.Einwohner.in.EUR")%>%
  filter(Verf_Einkommen != "NA")%>%
  select(-Column1)%>%
  mutate(OstWest = ifelse(LAND_ABK %in% c("MV", "BB", "SN", "TH", "ST"), "Ost", "West"))
verfeinkomm2016 <- within(verfeinkomm2016, {
        Verf_Einkommen <- as.numeric(as.character(Verf_Einkommen))
})
head(verfeinkomm2016, 5)

```

##### Visualisierung der Verteilungsmuster

Für die Visualisierung der Verteilungsmuster werden drei separate Datensätze generiert: jeweils ein Datensatz für Ost- und Westdeutschland und einer für Gesamtdeutschland.

```{r}

# Visualisierung der Verteilungsmuster in Gesamtdeutschland
ggplot(verfeinkomm2016, aes(Verf_Einkommen)) +
  geom_histogram(bins = 50) +
  theme_bw() +
  labs(title="Verfügbares Einkommen in Gesamtdeutschland - 2016", x="Verfügbares Einkommen in EUR", y="Anzahl der Landkreise")

# Visualisierung der Verteilungsmuster in Ostdeutschland
verfeinkomm2016 <- verfeinkomm2016%>%
  mutate(OstWest = ifelse(LAND_ABK %in% c("MV", "BB", "SN", "TH", "ST"), "Ost", "West"))
verfeinkomm2016ost <- filter(verfeinkomm2016, OstWest=="Ost")
head(verfeinkomm2016ost, 5)
ggplot(verfeinkomm2016ost, aes(Verf_Einkommen)) +
  geom_histogram(bins = 50) +
  theme_bw() +
  labs(title="Verfügbares Einkommen in Ostdeutschland - 2016", x="Verfügbares Einkommen in EUR", y="Anzahlder Landkreise")

# Visualisierung der Verteilungsmuster in Westdeutschland
verfeinkomm2016west <- filter(verfeinkomm2016, OstWest=="West")
head(verfeinkomm2016west, 5)
ggplot(verfeinkomm2016west, aes(Verf_Einkommen)) +
  geom_histogram(bins = 50) +
  theme_bw() +
  labs(title="Verfügbares Einkommen in Westdeutschland - 2016", x="Verfügbares Einkommen in EUR", y="Anzahl der Landkreise")

```

##### Interpretation

Alle drei Verteilungsmuster zeigen **ungefähr eine Normalverteilung**. Der Mittelwert liegt bei den westdeutschen Landkreisen etwa bei einem verfügbaren Einkommen von 23.000 EUR. In Ostdeutschland liegt dieser Mittelwert bei rund 19.000 EUR. Für Gesamtdeutschland ergibt sich so ein Mittelwert von ungefähr 21.000 bis 22.000 EUR. Die Ausreißer nach oben werden ausschließlich von westdeutschen Landkreisen beigesteuert. 


#### Entwicklung der verfügbaren Einkommen im Zeitverlauf in Ost und West

##### Aufbereitung der Daten für die Jahre 2002 bis 2013

```{r}

# Daten für 2013 aufbereiten
verfeinkomm2013 <- verfeinkomm%>%
  filter(Year=="2013")%>%
  rename("Verf_Einkommen"="Verfügbares.Einkommen.je.Einwohner.in.EUR")%>%
  filter(Verf_Einkommen != "NA")%>%
  select(-Column1)%>%
  mutate(OstWest = ifelse(LAND_ABK %in% c("MV", "BB", "SN", "TH", "ST"), "Ost", "West"))
verfeinkomm2013 <- within(verfeinkomm2013, {
        Verf_Einkommen <- as.numeric(as.character(Verf_Einkommen))
})
head(verfeinkomm2013, 5)
verfeinkomm2013ost <- filter(verfeinkomm2013, OstWest=="Ost")
verfeinkomm2013west <- filter(verfeinkomm2013, OstWest=="West")

# Daten für 2009 aufbereiten
verfeinkomm2009 <- verfeinkomm%>%
  filter(Year=="2009")%>%
  rename("Verf_Einkommen"="Verfügbares.Einkommen.je.Einwohner.in.EUR")%>%
  filter(Verf_Einkommen != "NA")%>%
  select(-Column1)%>%
  mutate(OstWest = ifelse(LAND_ABK %in% c("MV", "BB", "SN", "TH", "ST"), "Ost", "West"))
verfeinkomm2009 <- within(verfeinkomm2009, {
        Verf_Einkommen <- as.numeric(as.character(Verf_Einkommen))
})
head(verfeinkomm2009, 5)
verfeinkomm2009ost <- filter(verfeinkomm2009, OstWest=="Ost")
verfeinkomm2009west <- filter(verfeinkomm2009, OstWest=="West")

# Daten für 2005 aufbereiten
verfeinkomm2005 <- verfeinkomm%>%
  filter(Year=="2005")%>%
  rename("Verf_Einkommen"="Verfügbares.Einkommen.je.Einwohner.in.EUR")%>%
  filter(Verf_Einkommen != "NA")%>%
  select(-Column1)%>%
  mutate(OstWest = ifelse(LAND_ABK %in% c("MV", "BB", "SN", "TH", "ST"), "Ost", "West"))
verfeinkomm2005 <- within(verfeinkomm2005, {
        Verf_Einkommen <- as.numeric(as.character(Verf_Einkommen))
})
head(verfeinkomm2005, 5)
verfeinkomm2005ost <- filter(verfeinkomm2005, OstWest=="Ost")
verfeinkomm2005west <- filter(verfeinkomm2005, OstWest=="West")

# Daten für 2002 aufbereiten
verfeinkomm2002 <- verfeinkomm%>%
  filter(Year=="2002")%>%
  rename("Verf_Einkommen"="Verfügbares.Einkommen.je.Einwohner.in.EUR")%>%
  filter(Verf_Einkommen != "NA")%>%
  select(-Column1)%>%
  mutate(OstWest = ifelse(LAND_ABK %in% c("MV", "BB", "SN", "TH", "ST"), "Ost", "West"))
verfeinkomm2002 <- within(verfeinkomm2002, {
        Verf_Einkommen <- as.numeric(as.character(Verf_Einkommen))
})
head(verfeinkomm2002, 5)
verfeinkomm2002ost <- filter(verfeinkomm2002, OstWest=="Ost")
verfeinkomm2002west <- filter(verfeinkomm2002, OstWest=="West")

```

##### Erstellen von Boxplots für die Daten der Jahre 2002, 2005, 2009, 2013, 2016

```{r}

# Boxplot für 2002
plot2002 <- ggplot(verfeinkomm2002, aes(x=OstWest, y=Verf_Einkommen, fill=OstWest)) +
  geom_boxplot(outlier.size=2) +
  theme_light() +
  scale_y_log10() +
  labs(title="Verf. Einkommen (Ost/West) - 2002", x="", y="")

# Boxplot für 2005
plot2005 <- ggplot(verfeinkomm2005, aes(x=OstWest, y=Verf_Einkommen, fill=OstWest)) +
  geom_boxplot(outlier.size=2) +
  theme_light() +
  scale_y_log10() +
  labs(title="Verf. Einkommen (Ost/West) - 2005", x="", y="")

# Boxplot für 2009
plot2009 <- ggplot(verfeinkomm2009, aes(x=OstWest, y=Verf_Einkommen, fill=OstWest)) +
  geom_boxplot(outlier.size=2) +
  theme_light() +
  scale_y_log10() +
  labs(title="Verf. Einkommen (Ost/West) - 2009", x="", y="")

# Boxplot für 2013
plot2013 <- ggplot(verfeinkomm2013, aes(x=OstWest, y=Verf_Einkommen, fill=OstWest)) +
  geom_boxplot(outlier.size=2) +
  theme_light() +
  scale_y_log10() +
  labs(title="Verf. Einkommen (Ost/West) - 2013", x="", y="")

# Boxplot für 2016
plot2016 <- ggplot(verfeinkomm2016, aes(x=OstWest, y=Verf_Einkommen, fill=OstWest)) +
  geom_boxplot(outlier.size=2) +
  theme_light() +
  scale_y_log10() +
  labs(title="Verf. Einkommen (Ost/West) - 2016", x="", y="")

# Anordnen der Boxplots in Tabellenformat
require(gridExtra)
grid.arrange(plot2002, plot2009, plot2013, plot2016, ncol=2)

```

##### Interpretation

Die Boxplots für die Jahre 2002 bis 2016 zeigen deutlich, dass es **im gesamten Beobachtungszeitraum einen deutlichen Unterschied zwischen ost- und westdeutschen Landkreisen** gibt. Der Median der westdeutschen Verteilung liegt im gesamten Zeitraum oberhalt des dritten Quartils der ostdeutschen Werte. Die Boxplots des Jahres 2016 deuten darauf hin, dass sich der Abstand zwischen Ost und West leicht verringert haben könnte, doch ist er nach wie vor deutlich ausgeprägt. Ebenfalls auffällig: **Im Jahre 2002 erkennt man nur wenige Ausreißer** - lediglich einige westdeutsche Landkreise weichen nach oben ab. In den Folgejahren sind verstärkt Ausreißer zu beobachten, in Westdeutschland sogar nach oben und nach unten. **Im Jahre 2016 liegen die unteren Ausreißer in Westdeutschland sogar unterhalb des niedrigsten Wertes in Ostdeutschland.** 


#### Darstellung der Entwicklung der verfügbaren Einkommen im Liniendiagramm

```{r}

# Verbindung der Daten einzelner Jahre zu einer Gesamtdatei
verfeinkommen_all <- rbind(verfeinkomm2002, verfeinkomm2005, verfeinkomm2009, verfeinkomm2013, verfeinkomm2016)
head(verfeinkommen_all, 5)

# Datenaufbereitung - Berechnung der Medianwerte für alle Jahre
verfeinkommen_all <- verfeinkommen_all%>%
  group_by(Year, OstWest)%>%
  summarize(median(Verf_Einkommen, Year))%>%
  rename("Verf_Einkommen"="median(Verf_Einkommen, Year)")
head(verfeinkommen_all, 5)

# Visualisierung der Daten im Liniendiagramm
ggplot(verfeinkommen_all, aes(x=Year, y=Verf_Einkommen, color=OstWest)) +
  geom_line() +
  theme_classic() +
  labs(title="Verfügbare Einkommen (Ost/West)", subtitle="Zeitraum 2002 - 2016", x="", y="")

```

##### Interpretation

Das Liniendiagramm zeigt anschaulich, dass sich im Betrachtungszeitraum 2002 bis 2016 die **verfügbaren Einkommen in Deutschland kontinuierlich nach oben entwickelt** haben. Diese Entwicklung zeigt sich in den ostdeutschen Landkreisen ebenso wie in Westdeutschland. Auffällig ist jedoch, dass sich über den gesamten Zeitraum der **Abstand zwischen den ost- und westdeutschen Landkreisen nicht verringert**. Westdeutschland liegt auch im Jahre 2016 noch rund 4.000 bis 5.000 EUR oberhalb der verfügbaren Einkommen in Ostdeutschland. 


#### Darstellung der Verteilung der verfügbaren Einkommen mit Hilfe eines Schwarmdiagramms

Für diese Form der Darstellung wird ein **Zusatzpaket zu ggplot2 namens 'beeswarm'** genutzt. Damit lässt sich die Verteilung in einer Art Mischung von Boxplot und Scatterchart aufzeigen. Besonders interessant: Neben der Verteilungsmuster lässt sich eine weitere, binäre Dimension darstellen. 

```{r}

# Verbindung aller Daten in einem Datensatz 
verfeinkommen_allbee <- rbind(verfeinkomm2002, verfeinkomm2005, verfeinkomm2009, verfeinkomm2013, verfeinkomm2016)
head(verfeinkommen_allbee, 5)

# Visualisierung mit Hilfe eines 'Beeswarm-Charts'
library(ggbeeswarm)
ggplot(verfeinkommen_allbee, aes(x=Year, y=Verf_Einkommen, color=OstWest)) +
  geom_beeswarm(dodge.width=0.1) +
  labs(title="Verfügbare Einkommen (Ost/West)", subtitle="Zeitraum 2002 - 2016", x="Jahr", y="Verfügbares Einkommen in EUR")

```

##### Interpretation

Die Entwicklung der verfügbaren Einkommen in Ost und West lässt sich noch besser mit Hilfe eines Beeswarm-Charts zeigen. Hier entspricht **jeder Punkt im Diagramm einer Beobachtung**. Durch die Farbgebung lässt sich anzeigen, ob es sich um einen ost- oder westdeutschen Landkreis handelt. Sehr schön lässt sich in dieser Darstellung der kontinuierliche Anstieg der verfügbaren Einkommen im Betrachtungszeitraum beobachten. Sehr **deutlich kommt die Zweiteilung zum Ausdruck**. Das untere Drittel der Verteilung wird über den gesamten Zeitraum hinweg von ostdeutschen Landkreise besiedelt. Eine **Vermischung findet im Betrachtungszeit so gut wie nicht statt**. Lediglich in den Jahren 2013 und 2016 brechen drei bis vier ostdeutsche Landkreise nach oben aus. Etwas größer ist die Zahl der westdeutschen Landkreise, die sich nach unten entwickeln. Sehr deutlich zu erkennen ist die **größere Zahl einzelner Landkreise aus Westdeutschland, die Ausreißer nach oben** darstellen. 


#### Darstellung der Verteilung der Bruttoeinkommen mit Hilfe eines Schwarmdiagramms

```{r}

# Vorbereitung der Daten
bruttoeinkommen <- bruttoeinkomm%>%
  rename("Bruttoentgelte"="Bruttoentgelte.je.Beschäftigten.in.Tsd..EUR")%>%
  filter(Bruttoentgelte != "NA")%>%
  select(-Column1)%>%
  mutate(OstWest = ifelse(LAND_ABK %in% c("MV", "BB", "SN", "TH", "ST"), "Ost", "West"))
bruttoeinkommen <- within(bruttoeinkommen, {
        Bruttoentgelte <- as.numeric(as.character(Bruttoentgelte))
})
head(bruttoeinkommen, 5)

# Visualisierung mit Hilfe eines 'Beeswarm-Charts'
ggplot(bruttoeinkommen, aes(x=Year, y=Bruttoentgelte, color=OstWest)) +
  geom_beeswarm(dodge.width=0.1) +
  labs(title="Bruttoeinkommen (Ost/West)", subtitle="Zeitraum 1995 - 2017", x="Jahr", y="Bruttoeinkommen in EUR")


```

##### Interpretation

Auch für die Darstellung der Entwicklung der Bruttoeinkommen in Ost und West eignet sich das Beeswarm-Chart hervorragend. Das **Grundmuster ist ähnlich wie bei den verfügbaren Einkommen**. Sehr schön lässt sich auch hier der kontinuierliche Anstieg der verfügbaren Einkommen im Betrachtungszeitraum beobachten. Auch hier ist eine klare Zweiteilung zu erkennen - die ostdeutschen Landkreise befinden sich auch hier im unteren Drittel. Allerdings ist **beim Bruttoeinkommen eine höhere Vermischung** zu beobachten. Eine größere Zahl von ostdeutschen Landkreisen zeigen zunehmend Bruttoeinkommen im mittleren Bereich, insbesondere in den 2010er Jahren. Eine weitere Entwicklung, die sich in dieser Darstellung zeigen lässt: Während es beim Bruttoeinkommen **im Jahr 1995 noch kaum Ausreißer nach oben** gab, ist deren **Anzahl vor allem in den vergangenen zehn Jahren deutlich gestiegen**. 


### 5.4. Hypothesentests

Mit R lassen sich auf sehr einfache Weise statistische Berechnungen durchführen. Dies soll am Beispiel eines Hypothesentests und einer Korrelationsanalyse weiter vertieft werden. 

#### Formulierung der Hypothese

Die **Hypothese ist, dass sowohl im Jahr 1995 als auch im Jahr 2017 die statistischen Unterschiede bei den Bruttoeinkommen in Ost und West nach wie vor statistisch signifikant sind**. Mathematisch kann man das wie folgt ausdrücken: 

*H1a: mean_bruttoeinkommen(West-1995) - mean_bruttoeinkommen(Ost-1995) > 0*
*H1b: mean_bruttoeinkommen(West-2017) - mean_bruttoeinkommen(Ost-2017) > 0*

Die **Null-Hypothese** ist folglich die Aussage, dass es weder 1995 noch 2017 statistisch signifikante Unterschiede bei den Bruttoeinkommen in Ost und West gab. Mathematisch gesprochen: 

*H1a: mean_bruttoeinkommen(West-1995) - mean_bruttoeinkommen(Ost-1995) <= 0*
*H1b: mean_bruttoeinkommen(West-2017) - mean_bruttoeinkommen(Ost-2017) <= 0*

Angelegt werden soll bei unserem Test ein **Signifikanzniveau von 0.01**, um die Nullhypothesen zu verwerfen. **Werden beide Varianten der Nullhypothese verworfen, wird die Gesamthypothese als bestätigt gewertet**. 

#### Visualisierung der Verteilungsmuster

Zunächst sollen die Verteilungsmuster der Werte aus den Jahren 1995 und 2017 visuell dargestellt werden. Dieses geschieht mit Hilfe von Histogrammen. 

```{r}

# Verteilung der Bruttoeinkommen in Ost und West in den Jahren 1995 und 2017 - Histogramm-Darstellung

bruttoeinkommen1995ost <- bruttoeinkommen%>%
  filter(OstWest=="Ost")%>%
  filter(Year==1995)%>%
  select(Bruttoentgelte)
head(bruttoeinkommen1995ost, 5)

bruttoeinkommen1995west <- bruttoeinkommen%>%
  filter(OstWest=="West")%>%
  filter(Year==1995)%>%
  select(Bruttoentgelte)
head(bruttoeinkommen1995west, 5)

bruttoeinkommen2017ost <- bruttoeinkommen%>%
  filter(OstWest=="Ost")%>%
  filter(Year==2017)%>%
  select(Bruttoentgelte)
head(bruttoeinkommen2017ost, 5)

bruttoeinkommen2017west <- bruttoeinkommen%>%
  filter(OstWest=="West")%>%
  filter(Year==2017)%>%
  select(Bruttoentgelte)
head(bruttoeinkommen2017west, 5)

```

```{r}

# Erstellen der Histogramme

plot1995ost <- ggplot(bruttoeinkommen1995ost, aes(Bruttoentgelte)) +
  geom_histogram(bins = 30) +
  theme_classic() +
  labs(title="1995 Ost", x="Bruttoeinkommen in EUR", y="# LKR")

plot1995west <- ggplot(bruttoeinkommen1995west, aes(Bruttoentgelte)) +
  geom_histogram(bins = 30) +
  theme_classic() +
  labs(title="1995 West", x="Bruttoeinkommen in EUR", y="# LKR")

plot2017ost <- ggplot(bruttoeinkommen2017ost, aes(Bruttoentgelte)) +
  geom_histogram(bins = 30) +
  theme_classic() +
  labs(title="2017 Ost", x="Bruttoeinkommen in EUR", y="# LKR")

plot2017west <- ggplot(bruttoeinkommen2017west, aes(Bruttoentgelte)) +
  geom_histogram(bins = 30) +
  theme_classic() +
  labs(title="2017 West", x="Bruttoeinkommen in EUR", y="# LKR")

# Anordnung im Tabellenformat
require(gridExtra)
grid.arrange(plot1995ost, plot1995west, plot2017ost, plot2017west, ncol=2)

```

#### Berechnung wichtiger statistischer Kennzahlen

```{r}

summary(bruttoeinkommen1995ost)
summary(bruttoeinkommen1995west)
summary(bruttoeinkommen2017ost)
summary(bruttoeinkommen2017west)

```

#### Durchführung von t-Tests für die Jahre 1995 und 2017 

```{r}

# t-Test für Daten des Jahres 1995
X1 <- as.vector(bruttoeinkommen1995west$Bruttoentgelte)
Y1 <- as.vector(bruttoeinkommen1995ost$Bruttoentgelte)
t.test(x=X1, y=Y1, alternative = c("two.sided","less",
 "greater"), mu=0, var.equal=F, paired=F, conf.level=0.99)

```

```{r}

# t-Test für Daten des Jahres 2017
X1 <- as.vector(bruttoeinkommen2017west$Bruttoentgelte)
Y1 <- as.vector(bruttoeinkommen2017ost$Bruttoentgelte)
t.test(x=X1, y=Y1, alternative = c("two.sided","less",
 "greater"), mu=0, var.equal=F, paired=F, conf.level=0.99)


```

##### Interpretation

Zunächst werden die **Daten des Jahres 1995** betrachtet. Die Ergebnisse des t-Tests zeigen, dass die Nullhypothese H1a verworfen werden kann. Der **t-Wert ist mit 21,3 deutlich über dem Signifikanzniveau von 10,4**, welches bei einem Konfidenzniveau von 99% bei einem zweiseitigen t-Test angelegt wird. Der **p-Wert von annähernd null** zeigt, dass der Unterschied zwischen den ost- und westdeutschen Landkreisen auch statistisch signifikant ist. 

Im zweiten Schritt betrachten wir uns die **Daten des Jahres 2017**. Die Ergebnisse des t-Tests weisen hier einen **t-Wert von 15,5 auf, was ebenfalls oberhalb des Signifikanzniveaus von 14,0** liegt. Der **p-Wert ist auch hier annähernd null**, so dass auch in diesem Fall der Unterschied zwischen den ost- und westdeutschen Landkreisen statistisch signifikant ist. Wir können also auch die Nullhypothese H1b verwerfen.  

Abschließend können wir zusammenfassen, dass die **Gesamthypothese als bestätigt betrachtet werden kann**. Grund: **Sowohl die Nullhypothese H1a für das Jahr 1995 als auch die Nullhypothese H1b für das Jahr 2017 konnten verworfen werden**. Die Unterschiede zwischen beiden Gruppen waren in der Vergangenheit und sind auch heute (i.e. 2017) noch statistisch signifikant. 


